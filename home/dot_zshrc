#!/bin/zsh
# Main zshrc - source this from ~/.zshrc
#
# Add this line to your ~/.zshrc:
# [ -f ~/.config/shell/config.zsh ] && source ~/.config/shell/config.zsh

# Switch to fish if available (preferred shell)
# This approach uses exec to replace the current shell process,
# which doesn't require password or chsh permissions.
# Source: https://unix.stackexchange.com/a/136424
if command -v fish >/dev/null 2>&1; then
    export SHELL=$(command -v fish)
    # Only exec if not already in fish
    [ -z "$FISH_VERSION" ] && exec "$SHELL" -l
fi

# Zsh-specific configuration
setopt AUTO_CD              # cd by typing directory name if it's not a command
setopt CORRECT              # command auto-correction
setopt CORRECT_ALL          # argument auto-correction
setopt HIST_VERIFY          # verify history expansion
setopt SHARE_HISTORY        # share command history between sessions
setopt APPEND_HISTORY       # append to history file
setopt INC_APPEND_HISTORY   # append to history immediately
setopt HIST_IGNORE_DUPS     # ignore duplicate commands in history
setopt HIST_IGNORE_SPACE    # ignore commands that start with space

# History settings
HISTSIZE=10000
SAVEHIST=10000
HISTFILE="$HOME/.zsh_history"

# Source the main shell config FIRST (this sets up Homebrew and FPATH)
if [[ -f "$HOME/.config/shell/config.zsh" ]]; then
    source "$HOME/.config/shell/config.zsh"
fi

# Initialize Zsh completions AFTER sourcing config (so FPATH includes Homebrew paths)
# See: https://docs.brew.sh/Shell-Completion#configuring-completions-in-zsh
autoload -Uz compinit
compinit

# Case-insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
