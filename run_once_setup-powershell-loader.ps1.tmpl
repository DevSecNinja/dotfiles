$ErrorActionPreference = 'Stop'

if (-not $env:CHEZMOI_SOURCE_DIR) {
    throw "CHEZMOI_SOURCE_DIR is not set"
}

$sourceProfile = Join-Path $env:CHEZMOI_SOURCE_DIR `
    'Documents\PowerShell\Microsoft.PowerShell_profile.ps1'

$targetProfile = $PROFILE
$targetDir = Split-Path -Parent $targetProfile

if (-not (Test-Path $sourceProfile)) {
    throw "Signed profile not found at $sourceProfile"
}

if (-not (Test-Path $targetDir)) {
    New-Item -ItemType Directory -Path $targetDir -Force | Out-Null
}

Copy-Item -Path $sourceProfile -Destination $targetProfile -Force

Write-Host "âœ… Signed PowerShell profile deployed to $targetProfile"
